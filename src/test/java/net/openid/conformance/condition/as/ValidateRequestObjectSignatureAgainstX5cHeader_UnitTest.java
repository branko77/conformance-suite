package net.openid.conformance.condition.as;

import net.openid.conformance.condition.Condition;
import net.openid.conformance.condition.ConditionError;
import net.openid.conformance.logging.TestInstanceEventLog;
import net.openid.conformance.testmodule.Environment;
import org.bouncycastle.jce.provider.BouncyCastleProvider;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mock;
import org.mockito.Spy;
import org.mockito.junit.jupiter.MockitoExtension;

import java.security.Security;

import static org.junit.jupiter.api.Assertions.assertThrows;

@ExtendWith(MockitoExtension.class)
public class ValidateRequestObjectSignatureAgainstX5cHeader_UnitTest {
	@Spy
	private Environment env = new Environment();

	@Mock
	private TestInstanceEventLog eventLog;

	private ValidateRequestObjectSignatureAgainstX5cHeader cond;
	@BeforeEach
	public void setUp() throws Exception {
		cond = new ValidateRequestObjectSignatureAgainstX5cHeader();
		cond.setProperties("UNIT-TEST", eventLog, Condition.ConditionResult.INFO);
		Security.addProvider(new BouncyCastleProvider());
	}

	@Test
	public void evaluate_validateSignature1() {
		String requestObject = "eyJ4NWMiOlsiTUlJQkV6Q0J1NkFEQWdFQ0FoQnduYVI1amJvUTRSN05lL2src2ZoQ01Bb0dDQ3FHU000OUJBTUNNQTB4Q3pBSkJnTlZCQVlUQWs1TU1CNFhEVGN3TURFd01UQXdNREF3TUZvWERUSTFNVEV5TWpBNE1qSXhNbG93RFRFTE1Ba0dBMVVFQmhNQ1Rrd3dPVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndNaUFBTGNEMVh6S2VwRnhXTUFPcVYrbG4xZnliQnQ3RFJPNUNWMGY5QTZtUnAyeGFNZE1Cc3dHUVlEVlIwUkJCSXdFSUlPWm5WdWEyVXVZVzVwYlc4dWFXUXdDZ1lJS29aSXpqMEVBd0lEUndBd1JBSWdQTTVJVGZVRDZWV0xnUm04RXUxZ3c1M09mK1NVZGpTK3lSQ2xSNjhtLy80Q0lEeG5uZzdObkp5R25wc0tEdVVxU0lsL0EwclJRQ3dUTEJadzlIeDNNWm5aIl0sInR5cCI6IkpXVCIsImFsZyI6IkVTMjU2In0.eyJyZXNwb25zZV90eXBlIjoidnBfdG9rZW4iLCJjbGllbnRfaWQiOiJmdW5rZS5hbmltby5pZCIsImNsaWVudF9pZF9zY2hlbWUiOiJ4NTA5X3Nhbl9kbnMiLCJyZXNwb25zZV91cmkiOiJodHRwczovL2Z1bmtlLmFuaW1vLmlkL3Npb3AvZDg2NjI3MTItZWU3OC00MDZjLWE4OGMtZGY0ZmYxZWQ5NDY4L2F1dGhvcml6ZSIsInJlc3BvbnNlX21vZGUiOiJkaXJlY3RfcG9zdCIsIm5vbmNlIjoiMTkzOTYxNDEyMDE2NzU0NTQ2NzY2OTg1Iiwic3RhdGUiOiI4OTIxODQ5NzM3NTIxNzgzODEwOTI2MDciLCJjbGllbnRfbWV0YWRhdGEiOnsibG9nb191cmkiOiJodHRwczovL2Z1bmtlLmFuaW1vLmlkL2Fzc2V0cy92ZXJpZmllcnMvYW5pbW8vdmVyaWZpZXIuanBnIiwiY2xpZW50X25hbWUiOiJBbmltbyIsImNsaWVudF9pZCI6ImZ1bmtlLmFuaW1vLmlkIiwicGFzc0J5IjoiVkFMVUUiLCJyZXNwb25zZV90eXBlc19zdXBwb3J0ZWQiOlsidnBfdG9rZW4iXSwic3ViamVjdF9zeW50YXhfdHlwZXNfc3VwcG9ydGVkIjpbInVybjppZXRmOnBhcmFtczpvYXV0aDpqd2stdGh1bWJwcmludCIsImRpZDp3ZWIiLCJkaWQ6a2V5IiwiZGlkOmp3ayJdLCJ2cF9mb3JtYXRzIjp7Im1zb19tZG9jIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJqd3RfdmMiOnsiYWxnIjpbIkVkRFNBIiwiRVMyNTYiLCJFUzI1NksiXX0sImp3dF92Y19qc29uIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJqd3RfdnBfanNvbiI6eyJhbGciOlsiRWREU0EiLCJFUzI1NiIsIkVTMjU2SyJdfSwiand0X3ZwIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJsZHBfdmMiOnsicHJvb2ZfdHlwZSI6WyJFZDI1NTE5U2lnbmF0dXJlMjAxOCIsIkVkMjU1MTlTaWduYXR1cmUyMDIwIl19LCJsZHBfdnAiOnsicHJvb2ZfdHlwZSI6WyJFZDI1NTE5U2lnbmF0dXJlMjAxOCIsIkVkMjU1MTlTaWduYXR1cmUyMDIwIl19LCJ2YytzZC1qd3QiOnsia2Jfand0X2FsZ192YWx1ZXMiOlsiRWREU0EiLCJFUzI1NiIsIkVTMjU2SyJdLCJzZF9qd3RfYWxnX3ZhbHVlcyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19fX0sInByZXNlbnRhdGlvbl9kZWZpbml0aW9uIjp7ImlkIjoiNGRiNzQzMjgtOWU5NC00OWJiLTk3YjctYmJmY2IyZDExYTA2IiwibmFtZSI6IlBJRCAtIE5hbWUgYW5kIGFnZSB2ZXJpZmljYXRpb24gKHZjK3NkLWp3dCkiLCJwdXJwb3NlIjoiV2UgbmVlZCB0byB2ZXJpZnkgeW91ciBuYW1lIGFuZCBhZ2UiLCJpbnB1dF9kZXNjcmlwdG9ycyI6W3siaWQiOiJmYmUwZWIxNy0zMTJiLTRlZjMtOGVkZC1hOWM0NzI1MjdhOGUiLCJmb3JtYXQiOnsidmMrc2Qtand0Ijp7InNkLWp3dF9hbGdfdmFsdWVzIjpbIkVTMjU2Il0sImtiLWp3dF9hbGdfdmFsdWVzIjpbIkVTMjU2Il19fSwiY29uc3RyYWludHMiOnsibGltaXRfZGlzY2xvc3VyZSI6InJlcXVpcmVkIiwiZmllbGRzIjpbeyJwYXRoIjpbIiQuZ2l2ZW5fbmFtZSJdfSx7InBhdGgiOlsiJC5mYW1pbHlfbmFtZSJdfSx7InBhdGgiOlsiJC5hZ2VfZXF1YWxfb3Jfb3Zlci4yMSJdfSx7InBhdGgiOlsiJC52Y3QiXSwiZmlsdGVyIjp7InR5cGUiOiJzdHJpbmciLCJlbnVtIjpbImh0dHBzOi8vZXhhbXBsZS5ibWkuYnVuZC5kZS9jcmVkZW50aWFsL3BpZC8xLjAiLCJ1cm46ZXUuZXVyb3BhLmVjLmV1ZGk6cGlkOjEiXX19LHsicGF0aCI6WyIkLmlzcyJdLCJmaWx0ZXIiOnsidHlwZSI6InN0cmluZyIsImVudW0iOlsiaHR0cHM6Ly9kZW1vLnBpZC1pc3N1ZXIuYnVuZGVzZHJ1Y2tlcmVpLmRlL2MiLCJodHRwczovL2RlbW8ucGlkLWlzc3Vlci5idW5kZXNkcnVja2VyZWkuZGUvYzEiLCJodHRwczovL2RlbW8ucGlkLWlzc3Vlci5idW5kZXNkcnVja2VyZWkuZGUvYjEiXX19XX19XX0sImlzcyI6Imh0dHBzOi8vZnVua2UuYW5pbW8uaWQvc2lvcC9kODY2MjcxMi1lZTc4LTQwNmMtYTg4Yy1kZjRmZjFlZDk0NjgvYXV0aG9yaXplIiwiYXVkIjoiaHR0cHM6Ly9zZWxmLWlzc3VlZC5tZS92MiIsImV4cCI6MTczMjQ4MTU1NSwibmJmIjoxNzMyNDgxNDM1LCJpYXQiOjE3MzI0ODE0MzUsImp0aSI6ImRlYmUxODNjLTcyNzYtNDYyMC04Y2Y1LTMwNzlkNzJhZDBjMSJ9.hvo9l6KAeO5HO79Kkvg9P91xEzBtGAktViGIHbXl-SfJr7VncjDTRXb9fj9oMOpBvwaBntlP-FT3BnDoW9Cb0w";
		env.putString("authorization_request_object", "value", requestObject);
		cond.evaluate(env);
	}

	@Test
	public void evaluate_badSignature1() {
		assertThrows(ConditionError.class, () -> {
			String requestObject = "eyJ4NWMiOlsiTUlJQkV6Q0J1NkFEQWdFQ0FoQnduYVI1amJvUTRSN05lL2src2ZoQ01Bb0dDQ3FHU000OUJBTUNNQTB4Q3pBSkJnTlZCQVlUQWs1TU1CNFhEVGN3TURFd01UQXdNREF3TUZvWERUSTFNVEV5TWpBNE1qSXhNbG93RFRFTE1Ba0dBMVVFQmhNQ1Rrd3dPVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndNaUFBTGNEMVh6S2VwRnhXTUFPcVYrbG4xZnliQnQ3RFJPNUNWMGY5QTZtUnAyeGFNZE1Cc3dHUVlEVlIwUkJCSXdFSUlPWm5WdWEyVXVZVzVwYlc4dWFXUXdDZ1lJS29aSXpqMEVBd0lEUndBd1JBSWdQTTVJVGZVRDZWV0xnUm04RXUxZ3c1M09mK1NVZGpTK3lSQ2xSNjhtLy80Q0lEeG5uZzdObkp5R25wc0tEdVVxU0lsL0EwclJRQ3dUTEJadzlIeDNNWm5aIl0sInR5cCI6IkpXVCIsImFsZyI6IkVTMjU2In0.eyJyZXNwb25zZV90eXBlIjoidnBfdG9rZW4iLCJjbGllbnRfaWQiOiJmdW5rZS5hbmltby5pZCIsImNsaWVudF9pZF9zY2hlbWUiOiJ4NTA5X3Nhbl9kbnMiLCJyZXNwb25zZV91cmkiOiJodHRwczovL2Z1bmtlLmFuaW1vLmlkL3Npb3AvZDg2NjI3MTItZWU3OC00MDZjLWE4OGMtZGY0ZmYxZWQ5NDY4L2F1dGhvcml6ZSIsInJlc3BvbnNlX21vZGUiOiJkaXJlY3RfcG9zdCIsIm5vbmNlIjoiMTkzOTYxNDEyMDE2NzU0NTQ2NzY2OTg1Iiwic3RhdGUiOiI4OTIxODQ5NzM3NTIxNzgzODEwOTI2MDciLCJjbGllbnRfbWV0YWRhdGEiOnsibG9nb191cmkiOiJodHRwczovL2Z1bmtlLmFuaW1vLmlkL2Fzc2V0cy92ZXJpZmllcnMvYW5pbW8vdmVyaWZpZXIuanBnIiwiY2xpZW50X25hbWUiOiJBbmltbyIsImNsaWVudF9pZCI6ImZ1bmtlLmFuaW1vLmlkIiwicGFzc0J5IjoiVkFMVUUiLCJyZXNwb25zZV90eXBlc19zdXBwb3J0ZWQiOlsidnBfdG9rZW4iXSwic3ViamVjdF9zeW50YXhfdHlwZXNfc3VwcG9ydGVkIjpbInVybjppZXRmOnBhcmFtczpvYXV0aDpqd2stdGh1bWJwcmludCIsImRpZDp3ZWIiLCJkaWQ6a2V5IiwiZGlkOmp3ayJdLCJ2cF9mb3JtYXRzIjp7Im1zb19tZG9jIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJqd3RfdmMiOnsiYWxnIjpbIkVkRFNBIiwiRVMyNTYiLCJFUzI1NksiXX0sImp3dF92Y19qc29uIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJqd3RfdnBfanNvbiI6eyJhbGciOlsiRWREU0EiLCJFUzI1NiIsIkVTMjU2SyJdfSwiand0X3ZwIjp7ImFsZyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19LCJsZHBfdmMiOnsicHJvb2ZfdHlwZSI6WyJFZDI1NTE5U2lnbmF0dXJlMjAxOCIsIkVkMjU1MTlTaWduYXR1cmUyMDIwIl19LCJsZHBfdnAiOnsicHJvb2ZfdHlwZSI6WyJFZDI1NTE5U2lnbmF0dXJlMjAxOCIsIkVkMjU1MTlTaWduYXR1cmUyMDIwIl19LCJ2YytzZC1qd3QiOnsia2Jfand0X2FsZ192YWx1ZXMiOlsiRWREU0EiLCJFUzI1NiIsIkVTMjU2SyJdLCJzZF9qd3RfYWxnX3ZhbHVlcyI6WyJFZERTQSIsIkVTMjU2IiwiRVMyNTZLIl19fX0sInByZXNlbnRhdGlvbl9kZWZpbml0aW9uIjp7ImlkIjoiNGRiNzQzMjgtOWU5NC00OWJiLTk3YjctYmJmY2IyZDExYTA2IiwibmFtZSI6IlBJRCAtIE5hbWUgYW5kIGFnZSB2ZXJpZmljYXRpb24gKHZjK3NkLWp3dCkiLCJwdXJwb3NlIjoiV2UgbmVlZCB0byB2ZXJpZnkgeW91ciBuYW1lIGFuZCBhZ2UiLCJpbnB1dF9kZXNjcmlwdG9ycyI6W3siaWQiOiJmYmUwZWIxNy0zMTJiLTRlZjMtOGVkZC1hOWM0NzI1MjdhOGUiLCJmb3JtYXQiOnsidmMrc2Qtand0Ijp7InNkLWp3dF9hbGdfdmFsdWVzIjpbIkVTMjU2Il0sImtiLWp3dF9hbGdfdmFsdWVzIjpbIkVTMjU2Il19fSwiY29uc3RyYWludHMiOnsibGltaXRfZGlzY2xvc3VyZSI6InJlcXVpcmVkIiwiZmllbGRzIjpbeyJwYXRoIjpbIiQuZ2l2ZW5fbmFtZSJdfSx7InBhdGgiOlsiJC5mYW1pbHlfbmFtZSJdfSx7InBhdGgiOlsiJC5hZ2VfZXF1YWxfb3Jfb3Zlci4yMSJdfSx7InBhdGgiOlsiJC52Y3QiXSwiZmlsdGVyIjp7InR5cGUiOiJzdHJpbmciLCJlbnVtIjpbImh0dHBzOi8vZXhhbXBsZS5ibWkuYnVuZC5kZS9jcmVkZW50aWFsL3BpZC8xLjAiLCJ1cm46ZXUuZXVyb3BhLmVjLmV1ZGk6cGlkOjEiXX19LHsicGF0aCI6WyIkLmlzcyJdLCJmaWx0ZXIiOnsidHlwZSI6InN0cmluZyIsImVudW0iOlsiaHR0cHM6Ly9kZW1vLnBpZC1pc3N1ZXIuYnVuZGVzZHJ1Y2tlcmVpLmRlL2MiLCJodHRwczovL2RlbW8ucGlkLWlzc3Vlci5idW5kZXNkcnVja2VyZWkuZGUvYzEiLCJodHRwczovL2RlbW8ucGlkLWlzc3Vlci5idW5kZXNkcnVja2VyZWkuZGUvYjEiXX19XX19XX0sImlzcyI6Imh0dHBzOi8vZnVua2UuYW5pbW8uaWQvc2lvcC9kODY2MjcxMi1lZTc4LTQwNmMtYTg4Yy1kZjRmZjFlZDk0NjgvYXV0aG9yaXplIiwiYXVkIjoiaHR0cHM6Ly9zZWxmLWlzc3VlZC5tZS92MiIsImV4cCI6MTczMjQ4MTU1NSwibmJmIjoxNzMyNDgxNDM1LCJpYXQiOjE3MzI0ODE0MzUsImp0aSI6ImRlYmUxODNjLTcyNzYtNDYyMC04Y2Y1LTMwNzlkNzJhZDBjMSJ9.hvo9l6KAeO5HO79Kkvg9P91xEzBtGAktViGIHbXl-SfJr7VncjDTRXb9fj9oMOpBvwaBntlP-FT4BnDoW9Cb0w";
			env.putString("authorization_request_object", "value", requestObject);
			cond.evaluate(env);
		});
	}

}
